# 审慎地使用本地方法

`Java`本地接口（`JNI`）允许`Java`程序调用本地方法，这些方法是用本地编程语言（如`C`或`C++`）编写的。从历史上看，本地方法主要有三种用途。他们提供了对特定平台的设施访问，如：注册中心。它们提供对现有本地代码库的访问，包括提供对遗留数据访问的遗留库。最后，使用本地方法以本地语言编写应用程序的性能关键部分，以提高性能。

使用本地方法来访问特定于平台的工具是合法的，但是很少有必要。随着`Java`平台的成熟，它提供了对许多以前只能在主机平台上找到的特性的访问。例如，在`Java 9`中添加的流程`API`提供了对`OS`流程的访问。当`Java`中没有等价的库可用时，使用本地方法来使用本地库也是合法的。

**一般不建议使用本地方法来提高性能**。在早期的版本中（`Java 3`之前），这通常是必要的，但是从那时起，`jvm`变得更快了。对于大多数任务，现在用`Java`也可以获得同等的性能。比如，在`Java 1.1`版本中`java.math `加入了类库。当时，`BigInteger`依赖一个`C`语言编写的多精度的算术库。在`Java 3`中，`BigInteger `用`Java`重新实现了。而且经过小心优化后，比原来本地方法的实现运行还要快。

遗憾的是，从那以后，`BigInteger`就没什么变化。除了在`Java 8`中，对于大数的相乘速度有所提高。在此期间，在本地方法库上的工作继续快速进行着，尤其是`GNU`多精度算术库（`GMP`）。需要真正高性能多精度算法的`Java`程序员现在可以通过本地方法使用`GMP` [Blum14]。

使用本地方法有严重的缺点。由于本地语言不安全（条款50），使用本地方法的应用程序不再对内存损坏错误免疫。由于本地语言比`Java`更依赖于平台，因此使本地方法的程序可移植性较差。本地方法也更难调试。
如果不小心，本地方法可能会降低性能，因为垃圾收集器无法自动化甚至跟踪本地内存的使用（条款8），而且还有本地代码进出的成本。最后，本地方法需要“胶水代码”，读起来很困难，写起来也很繁琐。

总之，在使用本地方法之前要三思。你很少需要使用它们来提高性能。如果你必须使用本地方法来访问底层资源或本地库，则应尽可能少地使用本地代码并对其进行完整地测试。本地代码中的一个错误就可以破坏整个应用程序。