# 谨慎设计方法签名

本章是API设计方法的汇总，这当中每个方法都不值得单独列出。放在一起学习，它们将使你的API更容易学习和使用，并且更不容易出错。

**谨慎选择方法名称**。名称应始终遵循标准的命名约定（条款68）。你的主要目标应该是选择容易理解的并且与同一包下的其他名称一致的名称。你的第二个目标应该是选择与更广泛的共识相一致的名字。避免长方法名。如果有疑问，可以参考Java库的API。尽管存在大量的矛盾——考虑到这些库的规模和范围，这是不可避免的——但也存在相当多的共识。

**不要过分提供便捷的方法**。每一个方法都应该各司其职。太多的方法使得类难以学习、使用、记录、测试和维护。对于接口来说更是如此，在接口中，太多的方法会使接口的实现者和使用者的生活变得复杂。对于类或接口支持的每个操作，都应该充分地提供一个功能方法。且仅仅当这个操作被经常使用时，才要考虑提供一个速记法。**如果不确定，就不要这样做**。

**避免长参数列表**。目标是4个参数或者更少。因为大对数程序员无法记住更长的参数列表了。如果你的方法大多数都超过这个限制，而且还没有文档记录这些参数，那么你的API将不可用。虽然有先进的IDE的帮助，但是使用简短的参数列表仍然会让你的状况变得更好。长序列的相同类型的参数尤其有害。使用者不仅无法记住这些参数的顺序，而且当他们不小心将参数调换了顺序，他们的程序依然可以编译并运行。结果代码没有按作者意图的去执行。

这里有3种技术可以缩短过长的参数列表。一种方法是将该方法分解成多个方法，然后每个方法只需要之前参数的一个子集。如果不小心操作，这可能导致太多的方法，但它也可以通过增加正交性来帮助减少方法数量。比如，考虑一下`java.util.List`接口。它不提供查找子列表中元素的第一个或最后一个索引的方法，这两个方法都需要三个参数。取而代之的是，它提供了`subList`方法，该方法接受两个参数并返回一个子列表的视图。此方法可以与`indexOf`或`lastIndexOf`方法组合使用，这其中每个方法都有一个参数，最后生成我们所需的功能。此外，`subList`方法可以与操作列表实例的任何方法组合使用，以完成对子列表的任意计算。最后得到的API具有很高的性价比。

缩短长参数列表的第二种技术是创建一个辅助类来持有参数组。通常，这些辅助类是静态成员类（条款24）。如果代表不同实体的参数列表频繁出现，则建议使用此技术。举个例子，假设你正在写一个代表卡片游戏的类，并且你发现你自己不断地传递分别代表了卡片排行和它的套件的2个参数的序列。如果你增加一个辅助类代表卡片并且用这一个辅助类把每个有该参数序列的地方替换掉，那么你的API和你的类内部可能会得好处。

第三种技术结合了前两个并将构建器模式（条款2）从对象构造适配成方法调用。如果你有一个方法有很多参数，尤其当其中一些参数可选的时候，好的做法是：定义一个代表了所有参数的对象并为这个对象提供多个“setter”方法调用，每一个“setter”方法设置了一个参数或者小的相关组。一旦期望的参数设置好，客户端调用该对象的“execute”方法，该方法会对参数做一些最后的正确性校验，并且执行实际的计算。

**对于参数类型，优先选择接口而不是类**（条款64）。如果有合适的接口来定义参数，那么使用它来支持该接口的实现类。比如，我们不应该写一个接受`HashMap`类型的入参的方法，而应该用`Map`代替。这样做，你可以传`HashMap`、`TreeMap`、`ConcurrentHashMap`、`TreeMap`的子映射或任何尚未编写的映射实现。通过使用类而不是接口，你可以将客户端限制在特定的实现中，如果输入数据碰巧以某种其他形式存在，则会强制执行不必要的、可能代价很高的复制操作。

优先使用2个元素的枚举类型，而不是布尔参数。除非布尔值的含义对于方法名字来说是清晰的。枚举使代码更容易读和写。而且，以后添加更多的选项也很容易。例如，你可能有一个温度计类型和一个接受这个类型枚举的静态工厂：

```
public enum TemperatureScale { FAHRENHEIT, CELSIUS }
```

` Thermometer.newInstance(TemperatureScale.CELSIUS) `不仅比`Thermometer.newInstance(true) `更有意义，而且在以后的版本中，你可以添加`KELVIN `到`TemperatureScale `中，而不需要在`Thermometer `里添加新的静态工厂方法。此外，你还可以将温度刻度的依赖重构成依托枚举常量的方法（条款34）。比如，每一个刻度常量都可以有一个方法，它接受一个双精度值并且将它转成摄氏度。